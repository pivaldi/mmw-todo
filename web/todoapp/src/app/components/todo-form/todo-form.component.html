<div class="todo-form-container">
  <header class="page-header">
    <h1>{{ isEditMode ? 'Edit Todo' : 'Create New Todo' }}</h1>
  </header>

  <div *ngIf="loading && isEditMode" class="loading">
    <div class="spinner"></div>
    <p>Loading todo...</p>
  </div>

  <div *ngIf="error" class="error-message">
    {{ error }}
  </div>

  <form *ngIf="!loading || !isEditMode" [formGroup]="todoForm" (ngSubmit)="onSubmit()" class="todo-form">
    <div class="form-group">
      <label for="title">Title *</label>
      <input
        id="title"
        type="text"
        formControlName="title"
        class="form-control"
        [class.is-invalid]="f['title'].invalid && f['title'].touched"
        placeholder="Enter todo title"
        maxlength="200">
      <div *ngIf="f['title'].invalid && f['title'].touched" class="invalid-feedback">
        <div *ngIf="f['title'].errors?.['required']">Title is required</div>
        <div *ngIf="f['title'].errors?.['maxlength']">Title cannot exceed 200 characters</div>
      </div>
      <small class="form-text">{{ f['title'].value?.length || 0 }}/200 characters</small>
    </div>

    <div class="form-group">
      <label for="description">Description</label>
      <textarea
        id="description"
        formControlName="description"
        class="form-control"
        rows="4"
        placeholder="Enter todo description (optional)"></textarea>
    </div>

    <div class="form-group">
      <label for="priority">Priority *</label>
      <select id="priority" formControlName="priority" class="form-control">
        <option *ngFor="let priority of priorities" [value]="priority">
          {{ priority | titlecase }}
        </option>
      </select>
    </div>

    <div class="form-group">
      <label for="dueDate">Due Date</label>
      <input
        id="dueDate"
        type="datetime-local"
        formControlName="dueDate"
        class="form-control">
      <small class="form-text">Leave empty if no due date</small>
    </div>

    <div class="form-actions">
      <button
        type="submit"
        class="btn btn-primary"
        [disabled]="loading">
        <span *ngIf="loading" class="spinner-small"></span>
        {{ loading ? 'Saving...' : (isEditMode ? 'Update Todo' : 'Create Todo') }}
      </button>
      <button
        type="button"
        class="btn btn-secondary"
        (click)="cancel()"
        [disabled]="loading">
        Cancel
      </button>
    </div>
  </form>
</div>
